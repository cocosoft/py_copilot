# 告警规则配置文件
groups:
  - name: py_copilot_alerts
    rules:
      # 高错误率告警
      - alert: HighErrorRate
        expr: error_rate > 0.1  # 错误率超过10%
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "高错误率告警"
          description: "错误率超过阈值: {{ $value | humanizePercentage }}"
      
      # 慢响应告警
      - alert: SlowResponseTime
        expr: response_time_p95 > 5000  # P95响应时间超过5秒
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "慢响应告警"
          description: "P95响应时间超过阈值: {{ $value | humanize }}ms"
      
      # 高CPU使用率告警
      - alert: HighCPUUsage
        expr: cpu_usage > 80  # CPU使用率超过80%
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "高CPU使用率告警"
          description: "CPU使用率超过阈值: {{ $value | humanizePercentage }}"
      
      # 低可用内存告警
      - alert: LowAvailableMemory
        expr: available_memory_percent < 10  # 可用内存低于10%
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "低可用内存告警"
          description: "可用内存低于阈值: {{ $value | humanizePercentage }}"
      
      # 服务不可用告警
      - alert: ServiceDown
        expr: up == 0  # 服务状态为不可用
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "服务不可用告警"
          description: "服务 {{ $labels.job }} 不可用"
      
      # 高请求量告警
      - alert: HighRequestVolume
        expr: rate(request_count[5m]) > 1000  # 每分钟请求量超过1000
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "高请求量告警"
          description: "请求量超过阈值: {{ $value | humanize }} 请求/分钟"